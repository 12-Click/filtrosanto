<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Face Lens with Halo and Chin GIF</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #000;
            overflow: hidden;
        }
        .container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #video {
            position: absolute;
            width: 100vw;
            height: 100vh;
            object-fit: cover;
        }
        #overlay {
            position: absolute;
            width: 100vw;
            height: 100vh;
        }
    </style>
</head>
<body>
    <div class="container">
        <video id="video" autoplay playsinline></video>
        <canvas id="overlay"></canvas>
    </div>
    
    <!-- Load face-api.js from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/face-api.js"></script>

    <script>
        const video = document.getElementById('video');
        const overlay = document.getElementById('overlay');
        const ctx = overlay.getContext('2d');

        // Load face-api.js models from URLs
        async function loadModels() {
            const modelUrl = 'https://cdn.jsdelivr.net/gh/justadudewhohacks/face-api.js/models';
            await faceapi.nets.tinyFaceDetector.loadFromUri(modelUrl);
            await faceapi.nets.faceLandmark68TinyNet.loadFromUri(modelUrl);
        }

        // Start video stream
        async function startVideo() {
            const stream = await navigator.mediaDevices.getUserMedia({ video: {} });
            video.srcObject = stream;
        }

        // Draw halo and chin GIF based on detected face
        async function detectFace() {
            const detectionOptions = new faceapi.TinyFaceDetectorOptions();
            const detections = await faceapi.detectAllFaces(video, detectionOptions)
                                            .withFaceLandmarks(true);

            // Clear previous drawings
            ctx.clearRect(0, 0, overlay.width, overlay.height);

            detections.forEach(detection => {
                const { landmarks } = detection;

                // Get key points for placing images and text
                const chin = landmarks.getMouth()[3]; // Chin point (below mouth)
                const haloPosition = landmarks.getNose()[0]; // Nose (for halo above head)

                const haloY = haloPosition.y - 120;
                const haloX = haloPosition.x - 50;

                const chinY = chin.y + 30;
                const chinX = chin.x - 40;

                // Draw halo GIF above head
                const haloImg = new Image();
                haloImg.src = 'images/halo.gif'; // Replace with your halo GIF URL
                haloImg.onload = () => {
                    ctx.drawImage(haloImg, haloX, haloY, 150, 50);
                };

                // Draw chin GIF under the chin
                const chinGif = new Image();
                chinGif.src = 'images/text.gif'; // Replace with your chin GIF URL
                chinGif.onload = () => {
                    ctx.drawImage(chinGif, chinX, chinY, 80, 50);
                };

                // Draw text under the chin
                ctx.fillStyle = "#FFF";
                ctx.font = "20px Arial";
                ctx.textAlign = "center";
                ctx.fillText("Hello!", chin.x, chin.y + 80);
            });
        }

        // Initialize
        async function init() {
            await loadModels();
            await startVideo();

            video.addEventListener('play', () => {
                overlay.width = video.videoWidth;
                overlay.height = video.videoHeight;

                setInterval(detectFace, 100);
            });
        }

        init();
    </script>
</body>
</html>